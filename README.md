# SNN-TLM
This is a cycle-accurate SystemC TLM model of a **spiking neural network (SNN)** that implements a **fully connected feedforward network** with flexible number of layers. The network uses **leaky integrate-and-fire (LIF) neurons** and **event-driven computation**. The network parameters and input spikes are parsed from files generated by snntorch. The model is capable of flexibly assigning hardware neurons to network model.

## Publication
The related paper has been accepted in [IEEE JETCAS](https://ieeexplore.ieee.org/document/10299654).
[![Paper](https://img.shields.io/badge/Paper-IEEE%20JETCAS-blue.svg)](https://ieeexplore.ieee.org/document/10299654)

## Files
The code mainly consists of the following files:

- `top_level.cpp`: This file contains the **top-level module** of the SNN model, which instantiates and connects the submodules for each layer and the event controller. The submodules include **memory objects** that store the weights and biases, **accumulator objects** that perform the dot product between the input spikes and the weights, and **activation objects** that implement the LIF neuron dynamics and generate output spikes. The event controller is responsible for coordinating the computation and communication between the layers based on the availability of input spikes and output buffers.
- `event_control.cpp`: This file defines the event_control module, which is responsible for generating and controlling the events (spikes) for each layer. It also reads the input spike pattern file and the bias files for each layer.
- `defines.h`: This file contains the **global definitions and constants** used by the SNN model, such as the layer sizes, memory unit sizes, neuron parameters, file names, etc.
- `L*_accum.cpp`: These files define the accumulator modules for each layer, which are responsible for performing the dot product operation between the input spikes and the weights. They also implement a TLM target socket to communicate with the memory modules.
- `neuron_repl.cpp`: This file contains a utility program that replicates a single neuron module to generate multiple neuron modules with different parameters. It takes four arguments: layer number, neuron unit size, memory unit size, and number of neurons to replicate. It outputs a header file and a source file for each replicated neuron module.
- `sntorch_parsing_fc*.cpp`: These files contain utility programs that parse the raw data files generated by the snntorch (PyTorch-based SNN simulator) and convert them into weight and bias files that can be read by the memory objects. They take four arguments: layer number, neuron unit size, memory unit size, and whether to use bias or not. They output multiple weight files and one bias file for each layer.
- `makefile`: This file contains rules for compiling and running the SNN model and the utility programs.
- `custom_run.sh`: This file contains a shell script that automates the process of generating neuron modules, parsing data files, compiling and running the SNN model.

## Parameters

The code uses some global variables and constants defined in "defines.h". You can modify them according to your needs. Some of them are:

- INPUT_LAYER_SIZE: The number of neurons in the input layer.
- LAYER0_SIZE_LOGICAL: The number of neurons in the first hidden layer.
- LAYER1_SIZE_LOGICAL: The number of neurons in the second hidden layer.
- LAYER2_SIZE_LOGICAL: The number of neurons in the output layer.
- L0_NEURON_UNIT_SIZE: The neuron unit size in the first hidden layer.
- L1_NEURON_UNIT_SIZE: The neuron unit size in the second hidden layer.
- L2_NEURON_UNIT_SIZE: The neuron unit size in the output layer.
- TIME_STEP: The number of time steps for the spike train length.

## Usage
To run the SNN model, follow these steps:

1. Make sure you have SystemC installed on your system and set the `SYSTEMC` environment variable to point to its installation directory.
2. Run `./custom_run.sh` to execute the shell script that will generate neuron modules, parse data files, compile and run the SNN model.
3. Wait for the simulation to finish and check the output file `trace_log.txt` for the simulation time and output spikes.

Alternatively, you can run each step manually using the commands in `custom_run.sh`.

## License
This code is released under the MIT license. See LICENSE.txt for more details.
